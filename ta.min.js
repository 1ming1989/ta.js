/* ta.js (c) Nino Kroesen. MIT License. */ async function rsi(n,a){for(var r=a?a-1:13,t=[],e=[],s=1;s<n.length;s++){var o=(n[s]-n[s-1])/n[s]*100;if(t.push(o),t.length>=r){var u=0,h=0;for(q in t)t[q]<0&&(h+=t[q]),t[q]>=0&&(u+=t[q]);u/=r,h=Math.abs(h)/r,rsi=Number(100-100/(1+u/h)),e.push(rsi);o=(n[s]-n[s-1])/n[s]*100;t.push(o),t.splice(0,1)}}return e}async function tsi(n,a,r,t){for(var e=a||25,s=r||13,o=t||13,u=[],h=[],i=[],l=[],p=1;p<n.length;p++)u.push(n[p]-n[p-1]),h.push(Math.abs(n[p]-n[p-1]));var c=await ema(u,e),f=await ema(h,e),m=await ema(c,s),v=await ema(f,s);for(p=0;p<m.length;p++)i.push(m[p]/v[p]);var g=await ema(i,o);i.splice(0,i.length-g.length);for(p=0;p<g.length;p++)l.push([g[p],i[p]]);return l}async function pr(n,a){for(var r=a||14,t=[],e=[],s=0;s<n.length;s++)if(e.push(n[s]),e.length>=r-1){var o=await Math.max.apply(null,e),u=await Math.min.apply(null,e);t.push((o-n[s])/(o-u)*-100),e.splice(0,1)}return t}async function stoch(n,a,r,t){var e=a||14,s=r||3,o=t||3;e<s&&([e,s]=[s,e]),o>s&&([o,s]=[s,o]);for(var u=[],h=[],i=[],l=[],p=0;p<n.length;p++){if(h.push(n[p][0]),i.push(n[p][2]),h.length>=e){var c=await Math.max.apply(null,h),f=await Math.min.apply(null,i),m=100*(n[p][1]-f)/(c-f);l.push(m)}if(o>0&&l.length>o){var v=await sma(l,o);l.push(v[v.length-1])}if(l.length-o>=s){var g=await sma(l.slice(o),s);u.push([m,g[g.length-1]]),h.splice(0,1),i.splice(0,1),l.splice(0,1)}}return u}async function atr(n,a){for(var r=a||14,t=[],e=0;e<n.length;e++)if(t.length<1)t.push(n[e][0]-n[e][2]);else{var s=await Math.max(n[e][0]-n[e-1][1],n[e][2]-n[e-1][1],n[e][0]-n[e][2]),o=(t[t.length-1]*(r-1)+s)/r;t.push(o)}return t}async function sma(n,a){for(var r=a||14,t=[],e=[],s=0;s<n.length;s++)if(t.push(n[s]),t.length>=r){var o=0;for(q in t)o+=t[q];e.push(o/r),t.splice(0,1)}return e}async function smma(n,a){for(var r=a||14,t=[],e=[],s=0;s<n.length;s++)if(t.push(n[s]),t.length>=r){var o=0;for(q in t)o+=t[q];e?e.push(o/r):e.push((o-sma1+n[s])/r),t.splice(0,1)}return e.splice(0,1),e}async function wma(n,a){for(var r=a||14,t=0,e=1;e<=r;e++)t+=e;var s=[],o=[];for(e=0;e<n.length;e++)if(s.push(n[e]),s.length>=r){var u=0,h=1;for(q in s)u+=s[q]*h/t,h++;o.push(u),s.splice(0,1)}return o}async function vwma(n,a){for(var r=a||20,t=[],e=[],s=0;s<n.length;s++)if(t.push([n[s][0]*n[s][1],n[s][1]]),t.length>=r){for(var o=0,u=0,h=0;h<t.length;h++)o+=t[h][1],u+=t[h][0];e.push(u/o),t.splice(0,1)}return e}async function ema(n,a){for(var r=a||12,t=[],e=[],s=0,o=2/(r+1),u=0;u<n.length;u++){t.push(n[u]);var h=0;if(0==s&&t.length>=r){for(q in t)h+=t[q];h/=r,e.push(h),s=h}else 0!=s&&t.length>=r&&(h=(n[u]-s)*o+s,e.push(h),s=h)}return e}async function macd(n,a,r){var t=a||12,e=r||26;t>e&&([t,e]=[e,t]);var s=await ema(n,t),o=await ema(n,e);s.splice(0,e-t);for(var u=[],h=0;h<o.length;h++)u.push([s[h]-o[h]]);return u}async function bands(n,a,r){for(var t=a||14,e=r||1,s=[],o=[],u=[],h=await sma(n,t),i=0;i<n.length;i++)if(s.push(n[i]),s.length>=t){var l=await std(s,t);o.push(l),s.splice(0,1)}for(i=0;i<h.length;i++)u.push([h[i]+o[i]*e,h[i],h[i]-o[i]*e]);return u}async function bandwidth(n,a,r){for(var t=a||14,e=r||1,s=[],o=[],u=[],h=await sma(n,t),i=0;i<n.length;i++)if(s.push(n[i]),s.length>=t){var l=await std(s);o.push(l),s.push(n[i]),s.splice(0,1)}for(i=0;i<o.length;i++){var p=(h[i]+o[i]*e-(h[i]-o[i]*e))/h[i];u.push(p)}return u}async function keltner(n,a,r){var t,e=a||14,s=r||1,o=[],u=await atr(n,e),h=[];for(var i in n)o.push((n[i][0]+n[i][1]+n[i][2])/3);t=await ta.sma(o,e),u.splice(0,e-1);for(i=0;i<t.length;i++)h.push([t[i]+u[i]*s,t[i],t[i]-u[i]*s]);return h}async function std(n,a){var r=a||n.length,t=n.reduce((n,a)=>Number(n)+Number(a))/r;return Math.sqrt(n.reduce((n,a)=>n+Math.pow(a-t,2),0)/r)}async function dif(n,a){return(n-a)/a}async function aroon_up(n,a){for(var r=a||10,t=[],e=[],s=0;s<n.length;s++)if(t.push(n[s]),t.length>=r){var o=t.slice(0);o.sort((n,a)=>n-a);var u=o[r-1];e.push(100*(r-(t.findIndex(n=>n==u)+1))/r),t.splice(0,1)}return e}async function aroon_down(n,a){for(var r=a||10,t=[],e=[],s=0;s<n.length;s++)if(t.push(n[s]),t.length>=r){var o=t.slice(0);o.sort((n,a)=>n-a);var u=o[0];e.push(100*(r-(t.findIndex(n=>n==u)+1))/r),t.splice(0,1)}return e}async function aroon_osc(n,a){for(var r=a||25,t=[],e=await aroon.up(n,r),s=await aroon.down(n,r),o=0;o<e.length;o++)t.push(e[o]-s[o]);return t}async function mfi(n,a){for(var r=a||14,t=[],e=[],s=[],o=0;o<n.length;o++)if(s.push(n[o][0]),e.push(n[o][1]),s.length>=r){var u=0,h=0;for(q in s)u+=s[q];for(q in e)h+=e[q];t.push(100-100/(1+u/h)),s.splice(0,1),e.splice(0,1)}return t}async function roc(n,a){for(var r=a||14,t=[],e=[],s=0;s<n.length;s++)t.push(n[s]),t.length>=r&&(e.push((t[r-1]-t[0])/t[0]),t.splice(0,1));return e}async function obv(n){for(var a=[0],r=1;r<n.length;r++)n[r][1]>n[r-1][1]&&a.push(a[a.length-1]+n[r][0]),n[r][1]<n[r-1][1]&&a.push(a[a.length-1]-n[r][0]),n[r][1]==n[r-1][1]&&a.push(a[a.length-1]);return a}async function vwap(n,a){for(var r=!a||a>n.length?n.length:a,t=[],e=[],s=0;s<n.length;s++)if(t.push([n[s][0]*n[s][1],n[s][1]]),t.length>=r){for(var o=0,u=0,h=0;h<t.length;h++)o+=t[h][1],u+=t[h][0];e.push(u/o),t.splice(0,1)}return e}async function mom(n,a,r){for(var t=a||10,e=[],s=t-1;s<n.length;s++)r?e.push(n[s]/n[s-(t-1)]*100):e.push(n[s]-n[s-(t-1)]);return e}const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
