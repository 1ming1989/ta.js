/* ta.js (c) Nino Kroesen. MIT License. */ async function rsi(n,r){for(var t=r?r-1:13,e=[],a=[],s=1;s<n.length;s++){var u=(n[s]-n[s-1])/n[s]*100;if(e.push(u),e.length>=t){var h=0,o=0;for(q in e)e[q]<0&&(o+=e[q]),e[q]>=0&&(h+=e[q]);h/=t,o=Math.abs(o)/t,rsi=Number(100-100/(1+h/o)),a.push(rsi);u=(n[s]-n[s-1])/n[s]*100;e.push(u),e.splice(0,1)}}return a}async function stoch(n,r,t,e){var a=r||14,s=t||3,u=e||3;a<s&&([a,s]=[s,a]),u>s&&([u,s]=[s,u]);for(var h=[],o=[],l=[],i=[],p=0;p<n.length;p++){if(o.push(n[p][0]),l.push(n[p][2]),o.length>=a){var f=await Math.max.apply(null,o),c=await Math.min.apply(null,l),g=100*(n[p][1]-c)/(f-c);i.push(g)}if(u>0&&i.length>u){var v=await module.exports.sma(i,u);i.push(v[v.length-1])}if(i.length-u>=s){var m=await module.exports.sma(i.slice(u),s);h.push([g,m[m.length-1]]),o.splice(0,1),l.splice(0,1),i.splice(0,1)}}return h}async function atr(n,r){for(var t=r||14,e=[],a=0;a<n.length;a++)if(e.length<1)e.push(n[a][0]-n[a][2]);else{var s=await Math.max(n[a][0]-n[a-1][1],n[a][2]-n[a-1][1],n[a][0]-n[a][2]),u=(e[e.length-1]*(t-1)+s)/t;e.push(u)}return e}async function sma(n,r){for(var t=r||14,e=[],a=[],s=0;s<n.length;s++)if(e.push(n[s]),e.length>=t){var u=0;for(q in e)u+=e[q];a.push(u/t),e.splice(0,1)}return a}async function wma(n,r){for(var t=r||14,e=0,a=1;a<=t;a++)e+=a;var s=[],u=[];for(a=0;a<n.length;a++)if(s.push(n[a]),s.length>=t){var h=0,o=1;for(q in s)h+=s[q]*o/e,o++;u.push(h),s.splice(0,1)}return u}async function ema(n,r){for(var t=r||12,e=[],a=[],s=0,u=2/(t+1),h=0;h<n.length;h++){e.push(n[h]);var o=0;if(0==s&&e.length>=t){for(q in e)o+=e[q];o/=t,a.push(o),s=o}else 0!=s&&e.length>=t&&(o=(n[h]-s)*u+s,a.push(o),s=o)}return a}async function macd(n,r,t){var e=r||12,a=t||26;e>a&&([e,a]=[a,e]);var s=await module.exports.ema(n,e),u=await module.exports.ema(n,a);s.splice(0,a-e);for(var h=[],o=0;o<u.length;o++)h.push([s[o]-u[o]]);return h}async function bands(n,r,t){for(var e=r||14,a=t||1,s=[],u=[],h=[],o=await module.exports.sma(n,e),l=0;l<n.length;l++)if(s.push(n[l]),s.length>=e){var i=await module.exports.std(s,e);u.push(i),s.splice(0,1)}for(l=0;l<o.length;l++)h.push([o[l]+u[l]*a,o[l],o[l]-u[l]*a]);return h}async function bandwidth(n,r,t){for(var e=r||14,a=t||1,s=[],u=[],h=[],o=await module.exports.sma(n,e),l=0;l<n.length;l++)if(s.push(n[l]),s.length>=e){var i=await module.exports.std(s);u.push(i),s.push(n[l]),s.splice(0,1)}for(l=0;l<u.length;l++){var p=(o[l]+u[l]*a-(o[l]-u[l]*a))/o[l];h.push(p)}return h}async function std(n,r){var t=r||n.length,e=n.reduce((n,r)=>Number(n)+Number(r))/t;return Math.sqrt(n.reduce((n,r)=>n+Math.pow(r-e,2),0)/t)}async function aroon_up(n,r){for(var t=r||10,e=[],a=[],s=0;s<n.length;s++)if(e.push(n[s]),e.length>=t){var u=e.slice(0);u.sort((n,r)=>n-r);var h=u[t-1];a.push(100*(t-(e.findIndex(n=>n==h)+1))/t),e.splice(0,1)}return a}async function aroon_down(n,r){for(var t=r||10,e=[],a=[],s=0;s<n.length;s++)if(e.push(n[s]),e.length>=t){var u=e.slice(0);u.sort((n,r)=>n-r);var h=u[0];a.push(100*(t-(e.findIndex(n=>n==h)+1))/t),e.splice(0,1)}return a}async function aroon_osc(n,r){for(var t=r||25,e=[],a=await module.exports.aroon.up(n,t),s=await module.exports.aroon.down(n,t),u=0;u<a.length;u++)e.push(a[u]-s[u]);return e}async function mfi(n,r){for(var t=r||14,e=[],a=[],s=[],u=0;u<n.length;u++)if(s.push(n[u][0]),a.push(n[u][1]),s.length>=t){var h=0,o=0;for(q in s)h+=s[q];for(q in a)o+=a[q];e.push(100-100/(1+h/o)),s.splice(0,1),a.splice(0,1)}return e}async function roc(n,r){for(var t=r||14,e=[],a=[],s=0;s<n.length;s++)e.push(n[s]),e.length>=t&&(a.push((e[t-1]-e[0])/e[0]),e.splice(0,1));return a}async function obv(n){for(var r=[0],t=1;t<n.length;t++)n[t][1]>n[t-1][1]&&r.push(r[r.length-1]+n[t][0]),n[t][1]<n[t-1][1]&&r.push(r[r.length-1]-n[t][0]),n[t][1]==n[t-1][1]&&r.push(r[r.length-1]);return r}async function vwap(n,r){for(var t=!r||r>n.length?n.length:r,e=[],a=[],s=0;s<n.length;s++)if(e.push([n[s][0]*n[s][1],n[s][1]]),e.length>=t){for(var u=0,h=0,o=0;o<e.length;o++)u+=e[o][1],h+=e[o][0];a.push(h/u),e.splice(0,1)}return a}async function mom(n,r,t){for(var e=r||10,a=[],s=e-1;s<n.length;s++)t?a.push(n[s]/n[s-(e-1)]*100):a.push(n[s]-n[s-(e-1)]);return a}
