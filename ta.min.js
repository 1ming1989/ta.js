/* ta.js (c) Nino Kroesen. MIT License. */ async function rsi(n,a){for(var r=a?a-1:13,t=[],e=[],s=1;s<n.length;s++){var h=(n[s]-n[s-1])/n[s]*100;if(t.push(h),t.length>=r){var u=0,i=0;for(q in t)t[q]<0&&(i+=t[q]),t[q]>=0&&(u+=t[q]);u/=r,i=Math.abs(i)/r,rsi=Number(100-100/(1+u/i)),e.push(rsi);h=(n[s]-n[s-1])/n[s]*100;t.push(h),t.splice(0,1)}}return e}async function tsi(n,a,r,t){for(var e=a||25,s=r||13,h=t||13,u=[],i=[],l=[],o=[],p=1;p<n.length;p++)u.push(n[p]-n[p-1]),i.push(Math.abs(n[p]-n[p-1]));var f=await ema(u,e),c=await ema(i,e),g=await ema(f,s),v=await ema(c,s);for(p=0;p<g.length;p++)l.push(g[p]/v[p]);var w=await ema(l,h);l.splice(0,l.length-w.length);for(p=0;p<w.length;p++)o.push([w[p],l[p]]);return o}async function stoch(n,a,r,t){var e=a||14,s=r||3,h=t||3;e<s&&([e,s]=[s,e]),h>s&&([h,s]=[s,h]);for(var u=[],i=[],l=[],o=[],p=0;p<n.length;p++){if(i.push(n[p][0]),l.push(n[p][2]),i.length>=e){var f=await Math.max.apply(null,i),c=await Math.min.apply(null,l),g=100*(n[p][1]-c)/(f-c);o.push(g)}if(h>0&&o.length>h){var v=await sma(o,h);o.push(v[v.length-1])}if(o.length-h>=s){var w=await sma(o.slice(h),s);u.push([g,w[w.length-1]]),i.splice(0,1),l.splice(0,1),o.splice(0,1)}}return u}async function atr(n,a){for(var r=a||14,t=[],e=0;e<n.length;e++)if(t.length<1)t.push(n[e][0]-n[e][2]);else{var s=await Math.max(n[e][0]-n[e-1][1],n[e][2]-n[e-1][1],n[e][0]-n[e][2]),h=(t[t.length-1]*(r-1)+s)/r;t.push(h)}return t}async function sma(n,a){for(var r=a||14,t=[],e=[],s=0;s<n.length;s++)if(t.push(n[s]),t.length>=r){var h=0;for(q in t)h+=t[q];e.push(h/r),t.splice(0,1)}return e}async function wma(n,a){for(var r=a||14,t=0,e=1;e<=r;e++)t+=e;var s=[],h=[];for(e=0;e<n.length;e++)if(s.push(n[e]),s.length>=r){var u=0,i=1;for(q in s)u+=s[q]*i/t,i++;h.push(u),s.splice(0,1)}return h}async function vwma(n,a){for(var r=a||20,t=[],e=[],s=0;s<n.length;s++)if(t.push([n[s][0]*n[s][1],n[s][1]]),t.length>=r){for(var h=0,u=0,i=0;i<t.length;i++)h+=t[i][1],u+=t[i][0];e.push(u/h),t.splice(0,1)}return e}async function ema(n,a){for(var r=a||12,t=[],e=[],s=0,h=2/(r+1),u=0;u<n.length;u++){t.push(n[u]);var i=0;if(0==s&&t.length>=r){for(q in t)i+=t[q];i/=r,e.push(i),s=i}else 0!=s&&t.length>=r&&(i=(n[u]-s)*h+s,e.push(i),s=i)}return e}async function macd(n,a,r){var t=a||12,e=r||26;t>e&&([t,e]=[e,t]);var s=await s(n,t),h=await s(n,e);s.splice(0,e-t);for(var u=[],i=0;i<h.length;i++)u.push([s[i]-h[i]]);return u}async function bands(n,a,r){for(var t=a||14,e=r||1,s=[],h=[],u=[],i=await i(n,t),l=0;l<n.length;l++)if(s.push(n[l]),s.length>=t){var o=await std(s,t);h.push(o),s.splice(0,1)}for(l=0;l<i.length;l++)u.push([i[l]+h[l]*e,i[l],i[l]-h[l]*e]);return u}async function bandwidth(n,a,r){for(var t=a||14,e=r||1,s=[],h=[],u=[],i=await i(n,t),l=0;l<n.length;l++)if(s.push(n[l]),s.length>=t){var o=await std(s);h.push(o),s.push(n[l]),s.splice(0,1)}for(l=0;l<h.length;l++){var p=(i[l]+h[l]*e-(i[l]-h[l]*e))/i[l];u.push(p)}return u}async function std(n,a){var r=a||n.length,t=n.reduce((n,a)=>Number(n)+Number(a))/r;return Math.sqrt(n.reduce((n,a)=>n+Math.pow(a-t,2),0)/r)}async function aroon_up(n,a){for(var r=a||10,t=[],e=[],s=0;s<n.length;s++)if(t.push(n[s]),t.length>=r){var h=t.slice(0);h.sort((n,a)=>n-a);var u=h[r-1];e.push(100*(r-(t.findIndex(n=>n==u)+1))/r),t.splice(0,1)}return e}async function aroon_down(n,a){for(var r=a||10,t=[],e=[],s=0;s<n.length;s++)if(t.push(n[s]),t.length>=r){var h=t.slice(0);h.sort((n,a)=>n-a);var u=h[0];e.push(100*(r-(t.findIndex(n=>n==u)+1))/r),t.splice(0,1)}return e}async function aroon_osc(n,a){for(var r=a||25,t=[],e=await up(n,r),s=await down(n,r),h=0;h<e.length;h++)t.push(e[h]-s[h]);return t}async function mfi(n,a){for(var r=a||14,t=[],e=[],s=[],h=0;h<n.length;h++)if(s.push(n[h][0]),e.push(n[h][1]),s.length>=r){var u=0,i=0;for(q in s)u+=s[q];for(q in e)i+=e[q];t.push(100-100/(1+u/i)),s.splice(0,1),e.splice(0,1)}return t}async function roc(n,a){for(var r=a||14,t=[],e=[],s=0;s<n.length;s++)t.push(n[s]),t.length>=r&&(e.push((t[r-1]-t[0])/t[0]),t.splice(0,1));return e}async function obv(n){for(var a=[0],r=1;r<n.length;r++)n[r][1]>n[r-1][1]&&a.push(a[a.length-1]+n[r][0]),n[r][1]<n[r-1][1]&&a.push(a[a.length-1]-n[r][0]),n[r][1]==n[r-1][1]&&a.push(a[a.length-1]);return a}async function vwap(n,a){for(var r=!a||a>n.length?n.length:a,t=[],e=[],s=0;s<n.length;s++)if(t.push([n[s][0]*n[s][1],n[s][1]]),t.length>=r){for(var h=0,u=0,i=0;i<t.length;i++)h+=t[i][1],u+=t[i][0];e.push(u/h),t.splice(0,1)}return e}async function mom(n,a,r){for(var t=a||10,e=[],s=t-1;s<n.length;s++)r?e.push(n[s]/n[s-(t-1)]*100):e.push(n[s]-n[s-(t-1)]);return e}const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
