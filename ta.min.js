/* ta.js (c) Nino Kroesen. MIT License. */ async function rsi(n,r){for(var a=r?r-1:13,t=[],e=[],s=1;s<n.length;s++){var u=(n[s]-n[s-1])/n[s]*100;if(t.push(u),t.length>=a){var h=0,o=0;for(q in t)t[q]<0&&(o+=t[q]),t[q]>=0&&(h+=t[q]);h/=a,o=Math.abs(o)/a,rsi=Number(100-100/(1+h/o)),e.push(rsi);u=(n[s]-n[s-1])/n[s]*100;t.push(u),t.splice(0,1)}}return e}async function tsi(n,r,a,t){for(var e=r||25,s=a||13,u=t||13,h=[],o=[],l=[],i=[],p=1;p<n.length;p++)h.push(n[p]-n[p-1]),o.push(Math.abs(n[p]-n[p-1]));var f=await ema(h,e),c=await ema(o,e),g=await ema(f,s),v=await ema(c,s);for(p=0;p<g.length;p++)l.push(g[p]/v[p]);var m=await ema(l,u);l.splice(0,l.length-m.length);for(p=0;p<m.length;p++)i.push([m[p],l[p]]);return i}async function pr(n,r){for(var a=r||14,t=[],e=[],s=0;s<n.length;s++)if(e.push(n[s]),e.length>=a-1){var u=await Math.max.apply(null,e),h=await Math.min.apply(null,e);t.push((u-n[s])/(u-h)*-100),e.splice(0,1)}return t}async function stoch(n,r,a,t){var e=r||14,s=a||3,u=t||3;e<s&&([e,s]=[s,e]),u>s&&([u,s]=[s,u]);for(var h=[],o=[],l=[],i=[],p=0;p<n.length;p++){if(o.push(n[p][0]),l.push(n[p][2]),o.length>=e){var f=await Math.max.apply(null,o),c=await Math.min.apply(null,l),g=100*(n[p][1]-c)/(f-c);i.push(g)}if(u>0&&i.length>u){var v=await sma(i,u);i.push(v[v.length-1])}if(i.length-u>=s){var m=await sma(i.slice(u),s);h.push([g,m[m.length-1]]),o.splice(0,1),l.splice(0,1),i.splice(0,1)}}return h}async function atr(n,r){for(var a=r||14,t=[],e=0;e<n.length;e++)if(t.length<1)t.push(n[e][0]-n[e][2]);else{var s=await Math.max(n[e][0]-n[e-1][1],n[e][2]-n[e-1][1],n[e][0]-n[e][2]),u=(t[t.length-1]*(a-1)+s)/a;t.push(u)}return t}async function sma(n,r){for(var a=r||14,t=[],e=[],s=0;s<n.length;s++)if(t.push(n[s]),t.length>=a){var u=0;for(q in t)u+=t[q];e.push(u/a),t.splice(0,1)}return e}async function wma(n,r){for(var a=r||14,t=0,e=1;e<=a;e++)t+=e;var s=[],u=[];for(e=0;e<n.length;e++)if(s.push(n[e]),s.length>=a){var h=0,o=1;for(q in s)h+=s[q]*o/t,o++;u.push(h),s.splice(0,1)}return u}async function vwma(n,r){for(var a=r||20,t=[],e=[],s=0;s<n.length;s++)if(t.push([n[s][0]*n[s][1],n[s][1]]),t.length>=a){for(var u=0,h=0,o=0;o<t.length;o++)u+=t[o][1],h+=t[o][0];e.push(h/u),t.splice(0,1)}return e}async function ema(n,r){for(var a=r||12,t=[],e=[],s=0,u=2/(a+1),h=0;h<n.length;h++){t.push(n[h]);var o=0;if(0==s&&t.length>=a){for(q in t)o+=t[q];o/=a,e.push(o),s=o}else 0!=s&&t.length>=a&&(o=(n[h]-s)*u+s,e.push(o),s=o)}return e}async function macd(n,r,a){var t=r||12,e=a||26;t>e&&([t,e]=[e,t]);var s=await ema(n,t),u=await ema(n,e);s.splice(0,e-t);for(var h=[],o=0;o<u.length;o++)h.push([s[o]-u[o]]);return h}async function bands(n,r,a){for(var t=r||14,e=a||1,s=[],u=[],h=[],o=await sma(n,t),l=0;l<n.length;l++)if(s.push(n[l]),s.length>=t){var i=await std(s,t);u.push(i),s.splice(0,1)}for(l=0;l<o.length;l++)h.push([o[l]+u[l]*e,o[l],o[l]-u[l]*e]);return h}async function bandwidth(n,r,a){for(var t=r||14,e=a||1,s=[],u=[],h=[],o=await sma(n,t),l=0;l<n.length;l++)if(s.push(n[l]),s.length>=t){var i=await std(s);u.push(i),s.push(n[l]),s.splice(0,1)}for(l=0;l<u.length;l++){var p=(o[l]+u[l]*e-(o[l]-u[l]*e))/o[l];h.push(p)}return h}async function keltner(n,r,a){var t,e=r||14,s=a||1,u=[],h=await atr(n,e),o=[];for(var l in n)u.push((n[l][0]+n[l][1]+n[l][2])/3);t=await ta.sma(u,e),h.splice(0,e-1);for(l=0;l<t.length;l++)o.push([t[l]+h[l]*s,t[l],t[l]-h[l]*s]);return o}async function std(n,r){var a=r||n.length,t=n.reduce((n,r)=>Number(n)+Number(r))/a;return Math.sqrt(n.reduce((n,r)=>n+Math.pow(r-t,2),0)/a)}async function dif(n,r){return(n-r)/r}async function aroon_up(n,r){for(var a=r||10,t=[],e=[],s=0;s<n.length;s++)if(t.push(n[s]),t.length>=a){var u=t.slice(0);u.sort((n,r)=>n-r);var h=u[a-1];e.push(100*(a-(t.findIndex(n=>n==h)+1))/a),t.splice(0,1)}return e}async function aroon_down(n,r){for(var a=r||10,t=[],e=[],s=0;s<n.length;s++)if(t.push(n[s]),t.length>=a){var u=t.slice(0);u.sort((n,r)=>n-r);var h=u[0];e.push(100*(a-(t.findIndex(n=>n==h)+1))/a),t.splice(0,1)}return e}async function aroon_osc(n,r){for(var a=r||25,t=[],e=await aroon.up(n,a),s=await aroon.down(n,a),u=0;u<e.length;u++)t.push(e[u]-s[u]);return t}async function mfi(n,r){for(var a=r||14,t=[],e=[],s=[],u=0;u<n.length;u++)if(s.push(n[u][0]),e.push(n[u][1]),s.length>=a){var h=0,o=0;for(q in s)h+=s[q];for(q in e)o+=e[q];t.push(100-100/(1+h/o)),s.splice(0,1),e.splice(0,1)}return t}async function roc(n,r){for(var a=r||14,t=[],e=[],s=0;s<n.length;s++)t.push(n[s]),t.length>=a&&(e.push((t[a-1]-t[0])/t[0]),t.splice(0,1));return e}async function obv(n){for(var r=[0],a=1;a<n.length;a++)n[a][1]>n[a-1][1]&&r.push(r[r.length-1]+n[a][0]),n[a][1]<n[a-1][1]&&r.push(r[r.length-1]-n[a][0]),n[a][1]==n[a-1][1]&&r.push(r[r.length-1]);return r}async function vwap(n,r){for(var a=!r||r>n.length?n.length:r,t=[],e=[],s=0;s<n.length;s++)if(t.push([n[s][0]*n[s][1],n[s][1]]),t.length>=a){for(var u=0,h=0,o=0;o<t.length;o++)u+=t[o][1],h+=t[o][0];e.push(h/u),t.splice(0,1)}return e}async function mom(n,r,a){for(var t=r||10,e=[],s=t-1;s<n.length;s++)a?e.push(n[s]/n[s-(t-1)]*100):e.push(n[s]-n[s-(t-1)]);return e}const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
